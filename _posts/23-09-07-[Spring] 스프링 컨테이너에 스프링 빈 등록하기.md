--- 
layout: post 
categories: [Spring]
tags: [java,spring]
---

---

<br>
<br>


ì¸í”„ëŸ°ì˜ ê¹€ì˜í•œë‹˜ì˜ ìŠ¤í”„ë§ ê°•ì˜ì˜ ë‚´ìš©ì´ í¬í•¨ë˜ì–´ìˆìŠµë‹ˆë‹¤.

[ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ - ê¸°ë³¸í¸ - ì¸í”„ëŸ° | ê°•ì˜](https://www.inflearn.com/course/ìŠ¤í”„ë§-í•µì‹¬-ì›ë¦¬-ê¸°ë³¸í¸)

<br>
<br>

ì˜¤ëŠ˜ì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•´ ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•˜ê³  ì¡°íšŒí•˜ëŠ” ê³¼ì •ì— ëŒ€í•´ ì•Œì•„ë³´ì.

ë“¤ì–´ê°€ê¸°ì „ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ìŠ¤í”„ë§ ë¹ˆì— ëŒ€í•´ ì„¤ëª…í•˜ê³  ê°€ê² ë‹¤.


<br>
<br>

## ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ìŠ¤í”„ë§ ë¹ˆ?

---

<br>

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìŠ¤í”„ë§ ë¹ˆì˜ ë©”íƒ€ ë°ì´í„°ë¥¼ ì½ì–´ ì¸ìŠ¤í„´ìŠ¤í™”, êµ¬ì„± ë° ì¡°ë¦½ì„ ë‹´ë‹¹í•œë‹¤.

ìŠ¤í”„ë§ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ê²Œ ê´€ë¦¬ ë‹¹í•˜ëŠ” ìë°” ê°ì²´ë¥¼ ë§í•œë‹¤.

<br>

![Untitled](/assets/img/23-09-07-img/23-09-07(1).png)

<br>

**ApplicationContext** ë‚˜ **BeanFactory** ë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¼ ë¶€ë¥¸ë‹¤.

- **BeanFactory** : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ìµœìƒìœ„ ì¸í„°í˜ì´ìŠ¤, ìŠ¤í”„ë§ ë¹ˆì„ ê´€ë¦¬í•˜ê³  ì¡°íšŒí•˜ëŠ” ì—­í• ì„ ì œê³µí•œë‹¤.
- **ApplicationContext**  : **BeanFactory**ë¥¼ ëª¨ë‘ ìƒì†ë°›ì•„ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ë§ì€ ë¶€ê°€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

<br>

ApplicationContextë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤.

<br>

ApplicationContextë¥¼ ìŠ¤í”„ë§ ë¹ˆì˜ ë©”íƒ€ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ë°©ë²• ë³„ë¡œ êµ¬í˜„í•œ ê°ì²´ë“¤ì´ ìˆë‹¤.

- **AnnotaionConfigApplication** : @ì• ë„ˆíƒœì´ì…˜ ê¸°ë°˜ìœ¼ë¡œ ë©”íƒ€ ë°ì´í„°ë¥¼ ì½ì–´ì˜¨ë‹¤.
- **GenericXmlApplication** : XML ê¸°ë°˜ìœ¼ë¡œ ë©”íƒ€ ë°ì´í„°ë¥¼ ì½ì–´ì˜¨ë‹¤.

<br>
<br>

```java
ApplicationContext ac = new GenricXmlApplicationContext(appConfgi.xml);
ApplicationContext ac = new AnnotationApplicationContext(appConfig.class);
```
<br>
<br>
<br>

## ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡ ê³¼ì •

---

<br>

![Untitled](/assets/img/23-09-07-img/23-09-07(2).png)

<br>

 1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì„¤ì • íŒŒì¼ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ì–´ ì£¼ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìŠ¤í”„ë§ ë¹ˆì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì½ëŠ”ë‹¤.

<br>

![Untitled](/assets/img/23-09-07-img/23-09-07(3).png)

<br>

 2. ë©”íƒ€ ë°ì´í„°ë¥¼ ì½ì–´ì˜¨ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ê°ì²´ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ê°ì²´ì˜ ë©”íƒ€ ë°ì´í„°ë¥¼ ì½ì–´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ê´€ë¦¬ í•´ì¤€ë‹¤

ì ì´ì œ ì½”ë“œë¡œ êµ¬í˜„í•´ ë³´ì.

<br>
<br>
<br>

## êµ¬í˜„

---

<br>

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” Annotaionë°©ì‹ì„ ì‚¬ìš©í• ê²ƒì´ë‹¤.

<br>

**Repository**

```java
public interface MemberRepository {
    void save(Member member);
    Member findById(Long memberId);
}

public class MemoryMemberRepository implements MemberRepository{

    private static HashMap<Long, Member> store = new HashMap<>();

    @Override
    public void save(Member member) {
        store.put(member.getId(), member);
    }

    @Override
    public Member findById(Long memberId) {
        return store.get(memberId);
    }
}
```

<br>
<br>

**Service**

```java
public interface MemberService {
    void join(Member member);
    Member findMember(Long memberId);
}

public class MemberServiceImp implements MemberService{
    MemberRepository memberRepository;

    public MemberServiceImp(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

<br>

> MemberReposiroyëŠ” ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´í•˜ê³  êµ¬í˜„ ê°ì²´ëŠ” ì™¸ë¶€(AppConfig)ì—ì„œ ì£¼ì…í•´ì¤„ê²ƒì´ë‹¤.

<br>
<br>

**AppConfig.class**

<br>

```java
@Configuration
public class AppConfig {

    @Bean
    public MemberService memberService(){
        return new MemberServiceImp(new MemoryMemberRepository());
    }
}
```

<br>

- @Configuration  : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì„¤ì •íŒŒì¼ì„ ì‹ë³„í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì• ë„ˆí…Œì´ì…˜
- @Bean : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë  ê°ì²´ë¥¼ ì§€ì •í•´ ì£¼ëŠ” ì• ë„ˆí…Œì´ì…˜

<br>

Beanì˜ ì´ë¦„ì„ ì§€ì •í•´ì¤„ ìˆ˜ ìˆì§€ë§Œ ì§€ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´ Beanì˜ ì´ë¦„ì€ ë§¤ì„œë“œì˜ ì´ë¦„ìœ¼ë¡œ ì§€ì •ëœë‹¤.

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì„¤ì • íŒŒì¼ì„ ì½ì–´ memberServiceë¼ëŠ” ì´ë¦„ì˜ ìŠ¤í”„ë§ ë¹ˆì´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë ê²ƒì´ë‹¤.

<br>
<br>

**main.class**

```java
public class MemberApp  {
    public static void main(String[]args){

        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
        MemberService memberService = ac.getBean("memberService",MemberService.class);

        Member member = new Member(1L, "ê¹€ì¸ì—½");
        memberService.join(member);

        Member findMember = memberService.findMember(1L);

        System.out.println("member = " + member);
        System.out.println("findMember = " + findMember);
        System.out.println(member == findMember);
    }
}
```

<br>

1. `ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);` 
- ì• ë„ˆí…Œì´ì…˜ ê¸°ë°˜ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„±ê³¼ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡

2.  `MemberService memberService = ac.getBean("memberService",MemberService.class);`
- getBean(â€Beanì´ë¦„â€,Bean ê°ì²´ íƒ€ì…) : memberserviceë¼ëŠ” ì´ë¦„ì„  ê°€ì§„ ìŠ¤í”„ë§ë¹ˆì„ ë°˜í™˜í•œë‹¤.

3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ MemberServiceê°€ ì˜ì¡´í•˜ëŠ” MemberRepositoryì˜ êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±í•´ ì£¼ì…í•´ì¤€ë‹¤.

<br>

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ê³ , ìŠ¤í”„ë§ ë¹ˆì„ ì§ì ‘ ë“±ë¡í•´ë³´ì•˜ë‹¤.

ì´ì œëŠ” ìŠ¤í”„ë§ ë¹ˆì˜ ì¡°íšŒë°©ë²•ë“¤ì„ ì•Œì•„ ë³´ì.

<br>
<br>
<br>

## ìŠ¤í”„ë§ ë¹ˆ ì¡°íšŒí•˜ê¸°

---

<br>

ìœ„ì˜ ì˜ˆì œì—ì„  ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡í•œ ë¹ˆì´ 1ê°œë°–ì— ì—†ë‹¤.

ì˜ˆì œë¥¼ ìœ„í•´ ë¹ˆì„ ì¶”ê°€ í•´ì£¼ì—ˆë‹¤.

<br>

**Appconfig.class**

```java

@Configuration
public class Appconfig{

	@Bean
	MemberService memberService(){
		return	new MemberServiceImp(memberRepository());
	}

	@Bean
	OrderService orderService(){
		return	new OrderServiceImp(memberRepository(),discountPolicy());
	}

	@Bean
	MemberRepository memberRepository(){
			return new MemoryMemberRepository();
	}

	@Bean
	DiscountPolicy discountPolicy(){
			return new RateDiscountPolicy();
	}

```

<br>
<br>

### **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  ë¹ˆ ì¡°íšŒí•˜ê¸°**

<br>

```java
AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);   

 @Test
 @DisplayName("ëª¨ë“  ë¹ˆ ì¶œë ¥í•˜ê¸°")
void findAllBean(){
		String[] beanDefinitionNames = ac.getBeanDefinitionNames();
    for(String beanDefinitionName : beanDefinitionNames){
        Object bean = ac.getBean(beanDefinitionName);
        System.out.println("bean = " + beanDefinitionName + ", object = "+bean);
        }
    }
```

<br>

![Untitled](/assets/img/23-09-07-img/23-09-07(4).png)

<br>

ë°‘ì—ì„œ ë¶€í„° 4ê°œëŠ” ìš°ë¦¬ê°€ ì§ì ‘ ë“±ë¡í•œ (memberService, orderService, discountPolicy, memberRepository) ë¹ˆë“¤ì´ ë³´ì¸ë‹¤. 

ê·¼ë° ìì„¸íˆ ë³´ë©´ appConfigë„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœê²ƒë„ ë³´ì¸ë‹¤.

ì‚¬ì‹¤ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì„¤ì •í´ë˜ìŠ¤ë„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤.

ê·¸ë¦¬ê³  ë‚˜ë¨¸ì§€ëŠ” ìŠ¤í”„ë§ ìì²´ì—ì„œ ìƒì„±í•´ì£¼ëŠ” ìŠ¤í”„ë§ ë¹ˆë“¤ì´ë‹¤.

<br>
<br>

### **ë‚´ê°€ ë“±ë¡í•œ ë¹ˆë§Œ ì¡°íšŒ**

<br>

```java
@Test
@DisplayName("ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹ˆ ì¶œë ¥í•˜ê¸°")
void findApplicationBean(){
   String[] beanDefinitionNames = ac.getBeanDefinitionNames();
   for (String beanDefinitionName : beanDefinitionNames){
   BeanDefinition beanDefinition = ac.getBeanDefinition(beanDefinitionName);

    if(beanDefinition.getRole()==BeanDefinition.ROLE_APPLICATION){
    Object bean = ac.getBean(beanDefinitionName);
    System.out.println("bean = "+ beanDefinitionName + " , object = "+bean);
	  }
	}
}
```

<br>

- ROLE_APPLICATION : ì§ì ‘ ë“±ë¡í•œ ë¹ˆ
- ROLE_INFRASTRUCTURE: ìŠ¤í”„ë§ì´ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¹ˆ

<br>

> ê²°ê³¼
 
![Untitled](/assets/img/23-09-07-img/23-09-07(5).png)

<br>
<br>

### ë¹ˆ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ

<br>

```java
@Test
@DisplayName("ì´ë¦„ìœ¼ë¡œ ë¹ˆ ì¡°íšŒ")
void findBeanByName(){
	  MemberService memberService = ac.getBean("memberService",MemberService.class);
    System.out.println("memberService = " + memberService);
}
```

> ê²°ê³¼

![Untitled](/assets/img/23-09-07-img/23-09-07(6).png)

<br>
<br>

### ì´ë¦„ì—†ì´ íƒ€ì…ë§Œìœ¼ë¡œ ì¡°íšŒ

<br>

```java
@Test
@DisplayName("ì´ë¦„ì—†ì´ íƒ€ì…ë§Œìœ¼ë¡œ ì¡°íšŒ")
void findBeanByName(){
    MemberService memberService = ac.getBean(MemberService.class);
    System.out.println("memberService = " + memberService);
}
```

> ê²°ê³¼
> 

![Untitled](/assets/img/23-09-07-img/23-09-07(7).png)

<br>

<br>

<aside>
ğŸ’¡ ì—†ëŠ” ì´ë¦„ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ì œì‹œí•˜ë©´ NoSuchBeanDefinitionExceptionì„ ë°œìƒí•œë‹¤.

</aside>

<br>
<br>

### íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ê°™ì€ íƒ€ì…ì´ ë‘˜ ì´ìƒ ì¼ ê²½ìš°

<br>

**ì„¤ì •class**

```java
@Configuration
 static class SameBeanConfig {
 @Bean
 public MemberRepository memberRepository1() {
 return new MemoryMemberRepository();
 }
 @Bean
 public MemberRepository memberRepository2() {
 return new MemoryMemberRepository();
 }
 

```

<br>



- íƒ€ì…ì´ ê°™ì€ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡
```java
@Test
 @DisplayName("íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ê°™ì€ íƒ€ì…ì´ ë‘˜ ì´ìƒ ìˆì„ ê²½ìš°")
 void findBeanByTypeDuplicate() {
			MemberRepository bean = ac.getBean(MemberRepository.class);
      System.out.println("bean = " + bean);
}
```

<br>

> ê²°ê³¼ (NoUniqueBeanDefinitionException ë°œìƒ!!)

![Untitled](/assets/img/23-09-07-img/23-09-07(8).png)

<br>

íƒ€ì…ë§Œìœ¼ë¡œ ì¡°íšŒ ì‹œ ê°™ì€ íƒ€ì…ì˜ ë¹ˆë“¤ì´ ì—¬ëŸ¬ ìˆì„ ê²½ìš° ì¤‘ë³µ ì˜¤ë¥˜ë¥¼ ë°œìƒí•œë‹¤.

ê²€ìƒ‰í•  ë•Œ íƒ€ì…ê³¼ ì´ë¦„ì„ ëª¨ë‘ ë§¤ê°œë³€ìˆ˜ì— ì§€ì •í•´ì£¼ì.

<br>
<br>

### íŠ¹ì • íƒ€ì…ì˜ ë¹ˆë“¤ ì¡°íšŒí•˜ê¸°

<br>

```java
@Test
@DisplayName("íŠ¹ì • íƒ€ì… ì¡°íšŒ")
  void findAllBeanByType(){
     Map<String, MemberRepository> beansOfType = ac.getBeansOfType(MemberRepository.class);
	   for (String key: beansOfType.keySet()){
	   System.out.println("key = " + key + " value = "+beansOfType.get(key));
	 }
}
```

> ê²°ê³¼

![Untitled](/assets/img/23-09-07-img/23-09-07(9).png)

<br>
<br>

### ë¶€ëª¨íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ìì‹ì´ ë‘˜ ì´ìƒì¼ ê²½ìš°

<br>

**ì„¤ì •class**

```java
@Configuration
    static class TestConfig {
        @Bean
        public DiscountPolicy rateDiscountPolicy() {
            return new RateDiscountPolicy();
        }

        @Bean
        public DiscountPolicy fixDiscountPolicy() {
            return new FixDiscountPolicy();

   }
}
```

> DIscountPolicyë¥¼ êµ¬í˜„í•œ ë‘ê°œì˜ ê°ì²´ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡

<br>

```java
Test
 @DisplayName("ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ, ìì‹ì´ ë‘˜ ì´ìƒ ìˆì„ ê²½ìš°")
 void findBeanByParentTypeDuplicate() {
		DiscountPolicy bean = ac.getBean(DiscountPolicy.class);
		 

 }
```

> ê²°ê³¼ (NoUniqueBeanDefinitionException ë°œìƒ!!)
> 

![Untitled](/assets/img/23-09-07-img/23-09-07(10).png)

<br>

ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ìì‹ì´ ë‘˜ ì´ìƒì´ë¼ë©´ ì˜¤ë¥˜ë¥¼ ë°œìƒí•œë‹¤.

ì˜¤ë¥˜ë¥¼ ì¡ê¸° ìœ„í•´ì„  ë§¤ê°œë³€ìˆ˜ë¡œ ë¶€ëª¨íƒ€ì…ê³¼ ì´ë¦„ì„ ê°™ì´ ë„˜ê²¨ì£¼ì–´ì•¼í•œë‹¤.

<br>
<br>

### ë¶€ëª¨íƒ€ì…ìœ¼ë¡œ ìì‹íƒ€ì… ëª¨ë‘ ì¡°íšŒí•˜ê¸°

<br>

```java
@Test
    @DisplayName("ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ëª¨ë‘ ì¡°íšŒí•˜ê¸°")
    void findAllBeanByParentType() {
        Map<String, DiscountPolicy> beansOfType = ac.getBeansOfType(DiscountPolicy.class);
        for(String key : beansOfType.keySet()){
            System.out.println("key = "+key +", value = "+beansOfType.get(key));
        }
    }
```

> ê²°ê³¼
> 

![Untitled](/assets/img/23-09-07-img/23-09-07(11).png)
